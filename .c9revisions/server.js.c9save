{"ts":1372493899179,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"module.exports.conf = require('./conf/conf');\nvar domain = require('domain'),\n    http = require('http'),\n    fs = require('fs'),\n    path = require('path'),\n    zlib = require('zlib');\nvar serverDm = domain.create();\nvar processPath = path.dirname(process.argv[1]);\nglobal.yRead = {};\nyRead.version = '0.0.1';\n\nserverDm.on('error', function (err) {\n    delete err.domain;\n    yRead.errlog.error(err);\n});\nserverDm.run(function() {\n    yRead.conf = module.exports.conf = require('./conf/conf');\n    yRead.module = {};\n    yRead.module.rrestjs = require('rrestjs');\n    yRead.module.mongoskin = require('mongoskin');\n/*    yRead.module.marked = require('marked');\n    yRead.module.nodemailer = require('nodemailer');*/\n    yRead.errlog = yRead.module.rrestjs.restlog;\n    yRead.lib = {};\n    yRead.lib.tools = require('./lib/tools.js');\n    yRead.lib.CacheLRU = require('./lib/cacheLRU.js');\n    yRead.lib.CacheTL = require('./lib/cacheTL.js');\n    yRead.lib.msg = require('./lib/msg.js');\n    yRead.lib.model = require('./lib/model.js');\n    yRead.lib.converter = require('./lib/anyBaseConverter.js');\n    yRead.lib.email = require('./lib/email.js');\n    yRead.dao = {};\n    yRead.dao.db = require('./dao/mongoDao.js').db;\n    yRead.dao.articleDao = require('./dao/articleDao.js');\n    yRead.dao.bookDao = require('./dao/bookDao.js');\n    yRead.cache = {};\n    yRead.api = {};\n    yRead.api.book = require('./api/book.js');\n    yRead.api.art = require('./api/article.js');\n    yRead.api.dir = require('./api/directory.js');\n    creatServer();\n});\n\nfunction creatServer() {\n    var server = http.createServer(function(req, res) {\n        var dm = domain.create();\n        dm.on('error', function (err) {\n            console.log(err);\n            delete err.domain;\n            err.type = 'error';\n            try {\n                res.on('finish', function () {\n                    //yRead.dao.db.close();\n                    process.nextTick(function () {\n                        dm.dispose();\n                    });\n                });\n                if (err.hasOwnProperty('name')) {\n                    res.sendjson({\n                        err: err\n                    });\n                } else {\n                    //console.log('ReqErr:******************');\n                    console.log(req.session + ':' + req.method + ':' + req.path);\n                    yRead.errlog.error(err);\n                    res.sendjson({\n                        err: {\n                            name: 'Request Error',\n                            message: 'Sorryï¼ŒRequest Error!',\n                            type: 'error',\n                            url: '/'\n                        }\n                    });\n                }\n            } catch (err) {\n                delete err.domain;\n                //console.log('CatchERR:******************');\n                yRead.errlog.error(err);\n                dm.dispose();\n            }\n        });\n        dm.run(function () {\n            if (req.path[0] === 'api' && yRead.api[req.path[1]]) {\n                yRead.api[req.path[1]][req.method.toUpperCase()](req, res, dm);\n            } else {\n                res.setHeader(\"Content-Type\", \"text/html\");\n                if (yRead.indexTpl) {\n                    res.send(yRead.indexTpl);\n                } else {\n                    fs.readFile(processPath + '/web/index.html', 'utf8', serverDm.intercept(function (data) {\n                    //    yRead.indexTpl = data;\n                        res.send(data);\n                    }));\n                }\n            }//yRead.module.rrestjs.config.listenPort\n        });//process.env.PORT\n    }).listen(process.env.PORT);\n};"]],"start1":0,"start2":0,"length1":0,"length2":3671}]],"length":3671}
{"contributors":[],"silentsave":false,"ts":1372733711342,"patch":[[{"diffs":[[0,"/conf');"],[1,"\r"],[0,"\nvar dom"]],"start1":37,"start2":37,"length1":16,"length2":17},{"diffs":[[0,"omain'),"],[1,"\r"],[0,"\n    htt"]],"start1":70,"start2":70,"length1":16,"length2":17},{"diffs":[[0,"'http'),"],[1,"\r"],[0,"\n    fs "]],"start1":99,"start2":99,"length1":16,"length2":17},{"diffs":[[0,"e('fs'),"],[1,"\r"],[0,"\n    pat"]],"start1":124,"start2":124,"length1":16,"length2":17},{"diffs":[[0,"'path'),"],[1,"\r"],[0,"\n    zli"]],"start1":153,"start2":153,"length1":16,"length2":17},{"diffs":[[0,"'zlib');"],[1,"\r"],[0,"\nvar ser"]],"start1":182,"start2":182,"length1":16,"length2":17},{"diffs":[[0,"reate();"],[1,"\r"],[0,"\nvar pro"]],"start1":215,"start2":215,"length1":16,"length2":17},{"diffs":[[0,"rgv[1]);"],[1,"\r"],[0,"\nglobal."]],"start1":265,"start2":265,"length1":16,"length2":17},{"diffs":[[0,"ad = {};"],[1,"\r"],[0,"\nyRead.v"]],"start1":285,"start2":285,"length1":16,"length2":17},{"diffs":[[0,"'0.0.1';"],[-1,"\n"],[1,"\r\n\r"],[0,"\nserverD"]],"start1":311,"start2":311,"length1":17,"length2":19},{"diffs":[[0,"tion (err) {"],[1,"\r"],[0,"\n    delete "]],"start1":348,"start2":348,"length1":24,"length2":25},{"diffs":[[0," err.domain;"],[1,"\r"],[0,"\n    yRead.e"]],"start1":372,"start2":372,"length1":24,"length2":25},{"diffs":[[0,"or(err);"],[1,"\r"],[0,"\n});"],[1,"\r"],[0,"\nserverD"]],"start1":406,"start2":406,"length1":20,"length2":22},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n    yRead.c"]],"start1":434,"start2":434,"length1":24,"length2":25},{"diffs":[[0,"/conf');"],[1,"\r"],[0,"\n    yRe"]],"start1":502,"start2":502,"length1":16,"length2":17},{"diffs":[[0,"module = {};"],[1,"\r"],[0,"\n    yRead.m"]],"start1":522,"start2":522,"length1":24,"length2":25},{"diffs":[[0,"('rrestjs');"],[1,"\r"],[0,"\n    yRead.m"]],"start1":570,"start2":570,"length1":24,"length2":25},{"diffs":[[0,"oskin');"],[1,"\r"],[0,"\n/*    y"]],"start1":626,"start2":626,"length1":16,"length2":17},{"diffs":[[0,"arked');"],[1,"\r"],[0,"\n    yRe"]],"start1":674,"start2":674,"length1":16,"length2":17},{"diffs":[[0,"ler');*/"],[1,"\r"],[0,"\n    yRe"]],"start1":730,"start2":730,"length1":16,"length2":17},{"diffs":[[0,"restlog;"],[1,"\r"],[0,"\n    yRe"]],"start1":780,"start2":780,"length1":16,"length2":17},{"diffs":[[0,"ad.lib = {};"],[1,"\r"],[0,"\n    yRead.l"]],"start1":797,"start2":797,"length1":24,"length2":25},{"diffs":[[0,"/tools.js');"],[1,"\r"],[0,"\n    yRead.l"]],"start1":847,"start2":847,"length1":24,"length2":25},{"diffs":[[0,"cheLRU.js');"],[1,"\r"],[0,"\n    yRead.l"]],"start1":903,"start2":903,"length1":24,"length2":25},{"diffs":[[0,"acheTL.js');"],[1,"\r"],[0,"\n    yRead.l"]],"start1":957,"start2":957,"length1":24,"length2":25},{"diffs":[[0,"ib/msg.js');"],[1,"\r"],[0,"\n    yRead.l"]],"start1":1003,"start2":1003,"length1":24,"length2":25},{"diffs":[[0,"/model.js');"],[1,"\r"],[0,"\n    yRead.l"]],"start1":1053,"start2":1053,"length1":24,"length2":25},{"diffs":[[0,"verter.js');"],[1,"\r"],[0,"\n    yRead.l"]],"start1":1118,"start2":1118,"length1":24,"length2":25},{"diffs":[[0,"/email.js');"],[1,"\r"],[0,"\n    yRead.d"]],"start1":1168,"start2":1168,"length1":24,"length2":25},{"diffs":[[0,"ad.dao = {};"],[1,"\r"],[0,"\n    yRead.d"]],"start1":1189,"start2":1189,"length1":24,"length2":25},{"diffs":[[0,"js').db;"],[1,"\r"],[0,"\n    yRe"]],"start1":1246,"start2":1246,"length1":16,"length2":17},{"diffs":[[0,"articleDao.js');"],[1,"\r"],[0,"\n    yRead.dao.b"]],"start1":1298,"start2":1298,"length1":32,"length2":33},{"diffs":[[0,"ookDao.js');"],[1,"\r"],[0,"\n    yRead.c"]],"start1":1356,"start2":1356,"length1":24,"length2":25},{"diffs":[[0,".cache = {};"],[1,"\r"],[0,"\n    yRead.a"]],"start1":1379,"start2":1379,"length1":24,"length2":25},{"diffs":[[0,"pi = {};"],[1,"\r"],[0,"\n    yRe"]],"start1":1404,"start2":1404,"length1":16,"length2":17},{"diffs":[[0,"i/book.js');"],[1,"\r"],[0,"\n    yRead.a"]],"start1":1448,"start2":1448,"length1":24,"length2":25},{"diffs":[[0,"rticle.js');"],[1,"\r"],[0,"\n    yRead.a"]],"start1":1498,"start2":1498,"length1":24,"length2":25},{"diffs":[[0,"ry.js');"],[1,"\r"],[0,"\n    cre"]],"start1":1554,"start2":1554,"length1":16,"length2":17},{"diffs":[[0,"r();"],[1,"\r"],[0,"\n});"],[-1,"\n"],[1,"\r\n\r"],[0,"\nfun"]],"start1":1578,"start2":1578,"length1":13,"length2":16},{"diffs":[[0,"atServer() {"],[1,"\r"],[0,"\n    var ser"]],"start1":1603,"start2":1603,"length1":24,"length2":25},{"diffs":[[0,", res) {"],[1,"\r"],[0,"\n       "]],"start1":1664,"start2":1664,"length1":16,"length2":17},{"diffs":[[0,"in.create();"],[1,"\r"],[0,"\n        dm."]],"start1":1695,"start2":1695,"length1":24,"length2":25},{"diffs":[[0,"function (err) {"],[1,"\r"],[0,"\n            con"]],"start1":1732,"start2":1732,"length1":32,"length2":33},{"diffs":[[0,"le.log(err);"],[1,"\r"],[0,"\n           "]],"start1":1767,"start2":1767,"length1":24,"length2":25},{"diffs":[[0,"lete err.domain;"],[1,"\r"],[0,"\n            err"]],"start1":1795,"start2":1795,"length1":32,"length2":33},{"diffs":[[0,"'error';"],[1,"\r"],[0,"\n       "]],"start1":1836,"start2":1836,"length1":16,"length2":17},{"diffs":[[0,"   try {"],[1,"\r"],[0,"\n       "]],"start1":1855,"start2":1855,"length1":16,"length2":17},{"diffs":[[0,"', function () {"],[1,"\r"],[0,"\n               "]],"start1":1895,"start2":1895,"length1":32,"length2":33},{"diffs":[[0,".db.close();"],[1,"\r"],[0,"\n           "]],"start1":1944,"start2":1944,"length1":24,"length2":25},{"diffs":[[0,"ck(function () {"],[1,"\r"],[0,"\n               "]],"start1":1992,"start2":1992,"length1":32,"length2":33},{"diffs":[[0,"   dm.dispose();"],[1,"\r"],[0,"\n               "]],"start1":2031,"start2":2031,"length1":32,"length2":33},{"diffs":[[0,"             });"],[1,"\r"],[0,"\n               "]],"start1":2056,"start2":2056,"length1":32,"length2":33},{"diffs":[[0,"             });"],[1,"\r"],[0,"\n               "]],"start1":2077,"start2":2077,"length1":32,"length2":33},{"diffs":[[0,"ame')) {"],[1,"\r"],[0,"\n       "]],"start1":2136,"start2":2136,"length1":16,"length2":17},{"diffs":[[0,"  res.sendjson({"],[1,"\r"],[0,"\n               "]],"start1":2164,"start2":2164,"length1":32,"length2":33},{"diffs":[[0,"err: err"],[1,"\r"],[0,"\n       "]],"start1":2206,"start2":2206,"length1":16,"length2":17},{"diffs":[[0,"             });"],[1,"\r"],[0,"\n               "]],"start1":2223,"start2":2223,"length1":32,"length2":33},{"diffs":[[0,"        } else {"],[1,"\r"],[0,"\n               "]],"start1":2249,"start2":2249,"length1":32,"length2":33},{"diffs":[[0,"*************');"],[1,"\r"],[0,"\n               "]],"start1":2314,"start2":2314,"length1":32,"length2":33},{"diffs":[[0,"q.path);"],[1,"\r"],[0,"\n       "]],"start1":2405,"start2":2405,"length1":16,"length2":17},{"diffs":[[0,"rlog.error(err);"],[1,"\r"],[0,"\n               "]],"start1":2443,"start2":2443,"length1":32,"length2":33},{"diffs":[[0,"ndjson({"],[1,"\r"],[0,"\n       "]],"start1":2487,"start2":2487,"length1":16,"length2":17},{"diffs":[[0,"  err: {"],[1,"\r"],[0,"\n       "]],"start1":2519,"start2":2519,"length1":16,"length2":17},{"diffs":[[0,"uest Error',"],[1,"\r"],[0,"\n           "]],"start1":2567,"start2":2567,"length1":24,"length2":25},{"diffs":[[0,"Error!',"],[1,"\r"],[0,"\n       "]],"start1":2633,"start2":2633,"length1":16,"length2":17},{"diffs":[[0,"'error',"],[1,"\r"],[0,"\n       "]],"start1":2677,"start2":2677,"length1":16,"length2":17},{"diffs":[[0,"url: '/'"],[1,"\r"],[0,"\n       "]],"start1":2715,"start2":2715,"length1":16,"length2":17},{"diffs":[[0,"               }"],[1,"\r"],[0,"\n               "]],"start1":2734,"start2":2734,"length1":32,"length2":33},{"diffs":[[0,"             });"],[1,"\r"],[0,"\n               "]],"start1":2759,"start2":2759,"length1":32,"length2":33},{"diffs":[[0,"               }"],[1,"\r"],[0,"\n            } c"]],"start1":2778,"start2":2778,"length1":32,"length2":33},{"diffs":[[0," (err) {"],[1,"\r"],[0,"\n       "]],"start1":2815,"start2":2815,"length1":16,"length2":17},{"diffs":[[0,".domain;"],[1,"\r"],[0,"\n       "]],"start1":2851,"start2":2851,"length1":16,"length2":17},{"diffs":[[0,"*****');"],[1,"\r"],[0,"\n       "]],"start1":2914,"start2":2914,"length1":16,"length2":17},{"diffs":[[0,"or(err);"],[1,"\r"],[0,"\n       "]],"start1":2956,"start2":2956,"length1":16,"length2":17},{"diffs":[[0,"spose();"],[1,"\r"],[0,"\n       "]],"start1":2987,"start2":2987,"length1":16,"length2":17},{"diffs":[[0,";\r\n            }"],[1,"\r"],[0,"\n        });\n   "]],"start1":2994,"start2":2994,"length1":32,"length2":33},{"diffs":[[0,"     });"],[1,"\r"],[0,"\n       "]],"start1":3015,"start2":3015,"length1":16,"length2":17},{"diffs":[[0,"ion () {"],[1,"\r"],[0,"\n       "]],"start1":3045,"start2":3045,"length1":16,"length2":17},{"diffs":[[0,"h[1]]) {"],[1,"\r"],[0,"\n       "]],"start1":3113,"start2":3113,"length1":16,"length2":17},{"diffs":[[0,"es, dm);"],[1,"\r"],[0,"\n       "]],"start1":3194,"start2":3194,"length1":16,"length2":17},{"diffs":[[0,"        } else {"],[1,"\r"],[0,"\n               "]],"start1":3208,"start2":3208,"length1":32,"length2":33},{"diffs":[[0,"/html\");"],[1,"\r"],[0,"\n       "]],"start1":3277,"start2":3277,"length1":16,"length2":17},{"diffs":[[0,"exTpl) {"],[1,"\r"],[0,"\n       "]],"start1":3316,"start2":3316,"length1":16,"length2":17},{"diffs":[[0,"dexTpl);"],[1,"\r"],[0,"\n       "]],"start1":3363,"start2":3363,"length1":16,"length2":17},{"diffs":[[0,"} else {"],[1,"\r"],[0,"\n       "]],"start1":3389,"start2":3389,"length1":16,"length2":17},{"diffs":[[0,"(data) {"],[1,"\r"],[0,"\n       "]],"start1":3500,"start2":3500,"length1":16,"length2":17},{"diffs":[[0," = data;"],[1,"\r"],[0,"\n       "]],"start1":3550,"start2":3550,"length1":16,"length2":17},{"diffs":[[0,"d(data);"],[1,"\r"],[0,"\n       "]],"start1":3591,"start2":3591,"length1":16,"length2":17},{"diffs":[[0,"    }));"],[1,"\r"],[0,"\n       "]],"start1":3617,"start2":3617,"length1":16,"length2":17},{"diffs":[[0,"       }"],[1,"\r"],[0,"\n       "]],"start1":3636,"start2":3636,"length1":16,"length2":17},{"diffs":[[0,"stenPort"],[1,"\r"],[0,"\n       "]],"start1":3691,"start2":3691,"length1":16,"length2":17},{"diffs":[[0,"env.PORT"],[1,"\r"],[0,"\n    })."]],"start1":3722,"start2":3722,"length1":16,"length2":17},{"diffs":[[0,"v.PORT);"],[1,"\r"],[0,"\n};"]],"start1":3756,"start2":3756,"length1":11,"length2":12}]],"length":3768,"saved":false}
{"ts":1372733738068,"patch":[[{"diffs":[[0,"process.env."],[1,"OPENSHIFT_NODEJS_"],[0,"PORT);\r\n};"]],"start1":3746,"start2":3746,"length1":22,"length2":39}]],"length":3785,"saved":false}
{"contributors":[],"silentsave":false,"ts":1372738197953,"patch":[[{"diffs":[[0,"tory.js');\r\n"],[1,"    console.log(process.env.OPENSHIFT_INTERNAL_PORT+'..'+process.env.OPENSHIFT_INTERNAL_IP);\r\n"],[0,"    creatSer"]],"start1":1552,"start2":1552,"length1":24,"length2":118},{"diffs":[[0,"IFT_"],[-1,"NODEJS_PORT"],[1,"INTERNAL_PORT, process.env.OPENSHIFT_INTERNAL_IP"],[0,");\r\n"]],"start1":3858,"start2":3858,"length1":19,"length2":56}]],"length":3916,"saved":false}
{"ts":1372740794887,"patch":[[{"diffs":[[0,"ENSHIFT_"],[-1,"INTERNAL"],[1,"NODEJS"],[0,"_PORT"],[1," "],[0,", proces"]],"start1":3854,"start2":3854,"length1":29,"length2":28},{"diffs":[[0,"v.OPENSHIFT_"],[-1,"INTERNAL"],[1,"NODEJS"],[0,"_IP"],[1," "],[0,");\r\n};"]],"start1":3886,"start2":3886,"length1":29,"length2":28}]],"length":3914,"saved":false}
{"ts":1372741371317,"patch":[[{"diffs":[[0,"env."],[-1,"OPENSHIFT_NODEJS_PORT , process.env.OPENSHIFT_NODEJS_IP "],[1,"PORT"],[0,");\r\n"]],"start1":3848,"start2":3848,"length1":64,"length2":12}]],"length":3862,"saved":false}
